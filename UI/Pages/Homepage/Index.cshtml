@page
@using System.Text.Json
@model IndexModel
@{
    ViewData["Title"] = "Home page";
    ViewData["ShowBackground"] = true;
    ViewData["BackgroundImage"] = Url.Content("~/Images/startpage.png");
    int index = 0;
    
}

<script src="https://kit.fontawesome.com/6f575f0f1f.js" crossorigin="anonymous"></script>



<div class="index-text">
    <h4>Welcome back, Swizzy13. Here’s what we’ve been watching…</h4>
    <h6>This homepage will become customized as you follow active members on Letterboxd.</h6>
</div>


 <div class="section-container">
    <h6>New on Dusk Sky</h6>
    <hr>
 </div>


<div class="card-group custom-card-index">
   
    @if (Model.Juegos != null && Model.Juegos.Count > 0)
    {
        @foreach (var juego in Model.Juegos.Take(6))
        {
            <div class="card review-card">
    <img src="@juego.ImagenUrl" class="card-img-top" alt="@juego.Titulo">
    <div class="card-body d-flex align-items-center px-2 py-2">
        <img src="@juego.UsuarioAvatarUrl" class="avatar-img me-2" alt="avatar">
        <div class="flex-grow-1">
            <strong>@juego.UsuarioNombre</strong>
        </div>
        <span class=" small">@juego.Fecha.ToString("MMM dd")</span>
    </div>
    <div class="card-footer px-2 py-1 border-0 bg-transparent">
        <div class="rating-stars">
            @for (int i = 1; i <= 5; i++)
            {
                if (i <= Math.Floor(juego.Rating))
                {
                    <i class="bi bi-star-fill"></i>
                }
                else if (i - juego.Rating < 1)
                {
                    <i class="bi bi-star-half"></i>
                }
                else
                {
                    <i class="bi bi-star"></i>
                }
            }
        </div>
    </div>
</div>

        }

        @for (int i = Model.Juegos.Count; i < 6; i++)
        {
            <div class="card card-glossy m-2" style="width: 12rem;">
                <img src="https://via.placeholder.com/150" class="card-img-top poster" alt="Placeholder">
            </div>
        }
    }
    else
    {
        @for (int i = 0; i < 6; i++)
        {
            <div class="card card-glossy m-2" style="width: 12rem;">
                <img src="https://via.placeholder.com/150" class="card-img-top poster" alt="Placeholder">
            </div>
        }
    }
</div>

<div >
    <br>
    <h6>Popular with friends</h6>
    <hr>
    <div>
        <div class="card-group custom-card-reviewed">
            @if (Model.Juegos != null && Model.Juegos.Count > 0)
            {
                @foreach (var imagen in Model.Juegos.Take(6))
                {
                    <div class="card">
                        <div class="card-body">

                            <img src=@imagen.ImagenUrl class="card-img-top">
                        </div>
                    </div>
                }
                @for (int i = Model.Comentarios.Count; i < 10; i++)
                {
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">Sin Comentarios</h6>
                            <p class="card-text">No hay comentarios recientes.</p>
                        </div>
                    </div>
                }
            }
            else
            {
                @for (int i = 0; i < 10; i++)
                {
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">Cargando...</h6>
                            <p class="card-text">Esperando comentarios.</p>
                        </div>
                    </div>
                }
            }
        </div>

</div>

<div>
    <br>
    <h6>Popular reviews This week</h6>
    <hr>
    <div style="display: flex; gap: 20px; align-items: flex-start;">
        <div style="flex: 1;" class="d-flex flex-column gap-3">
            @foreach (var comentario in Model.Comentarios)
            {
                <div class="card mb-3 card-glossy d-flex flex-row">
                    <div class="flex-1">
                        <img src="https://th.bing.com/th/id/OIP.YYA1QSw8shFEvZFpR1QsEAHaEK?rs=1&pid=ImgDetMain"
                             class="img-fluid rounded-start" alt="Juego asociado">
                    </div>
                    <div class="flex-3 p-3 d-flex flex-column justify-content-between">
                        <div>
                            <h5 class="card-title">
                                @comentario.Texto.Substring(0, Math.Min(30, comentario.Texto.Length))...
                                <span class="year">@comentario.Fecha.ToString("yyyy")</span>
                            </h5>
                            <div class="d-flex align-items-center user-info mb-2">
                                <img src="@comentario.AvatarUrl" alt="@comentario.Usuario" class="user-avatar">
                                <span><strong>@comentario.Usuario</strong></span>
                                <span class="stars">❤️ @comentario.Likes</span>
                            </div>
                            <p class="card-text">@comentario.Texto</p>
                            <p class="card-text">
                                <small class="text-muted">Publicado el @comentario.Fecha.ToString("dd MMM")}"></small>
                            </p>
                        </div>
                        <div class="likes">
                            <i class="bi bi-heart-fill"></i> @comentario.Likes likes
                        </div>
                    </div>
                </div>
            }
        </div>

        <div style="flex: 1;" class="d-flex flex-column gap-4">
            @foreach (var comentario in Model.Comentarios)
            {
                <div class="card mb-3 card-glossy d-flex flex-row">
                    <div class="flex-1">
                        <img src="https://th.bing.com/th/id/OIP.YYA1QSw8shFEvZFpR1QsEAHaEK?rs=1&pid=ImgDetMain"
                             class="img-fluid rounded-start" alt="Juego asociado">
                    </div>
                    <div class="flex-3 p-3 d-flex flex-column justify-content-between">
                        <div>
                            <h5 class="card-title">
                                @comentario.Texto.Substring(0, Math.Min(30, comentario.Texto.Length))...
                                <span class="year">@comentario.Fecha.ToString("yyyy")</span>
                            </h5>
                            <div class="d-flex align-items-center user-info mb-2">
                                <img src="@comentario.AvatarUrl" alt="@comentario.Usuario" class="user-avatar">
                                <span><strong>@comentario.Usuario</strong></span>
                                <span class="stars">❤️ @comentario.Likes</span>
                            </div>
                            <p class="card-text">@comentario.Texto</p>
                            <p class="card-text">
                                <small class="text-muted">Publicado el @comentario.Fecha.ToString("dd MMM")}"></small>
                            </p>
                        </div>
                        <div class="likes">
                            <i class="bi bi-heart-fill"></i> @comentario.Likes likes
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<div>
    <h6><a href="/StartPage">Popular lists This week</a></h6>
    <hr>

    <!-- Scroll horizontal -->
    <div style="display: flex; overflow-x: auto; gap: 20px; padding-bottom: 10px;">
        @foreach (var seccion in Model.SeccionesJuegos)
        {
            var id = $"collage-{index++}";
            var json = JsonSerializer.Serialize(seccion.Value, new JsonSerializerOptions
            {
                PropertyNamingPolicy = JsonNamingPolicy.CamelCase
            });

            <div style="flex: 0 0 auto; width: 250px;" class="card card-glossy-light">
                <div id="@id" class="poster-collage" style="position: relative; height: 140px; overflow: hidden;"></div>
                <div class="card-body">
                    <h5 class="card-title" style="font-size: 1rem;">@seccion.Key</h5>

                    <div class="d-flex align-items-center user-info mb-2">
                        <img src="https://th.bing.com/th/id/R.3bf8be93ae6cd787ff90521a21d62fdf?rik=yTxsI786yWT4KA&pid=ImgRaw&r=0" alt="Usuario" class="user-avatar" style="width: 24px; height: 24px; border-radius: 50%; margin-right: 5px;">
                        <span><strong>Usuario123</strong></span>
                    </div>

                    <p class="card-text">
                        <small class="text-muted">Última actualización...</small>
                    </p>
                </div>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const pelis = @Html.Raw(json);
                    const cont = document.getElementById("@id");

                    if (cont && pelis) {
                        pelis.forEach((peli, i) => {
                            const img = document.createElement('img');
                            img.src = peli.imagenUrl;
                            img.alt = peli.titulo;
                            img.classList.add('poster');
                            img.style.position = 'absolute';
                            img.style.left = `${i * 40}px`;
                            img.style.height = '100%';
                            img.style.objectFit = 'cover';
                            cont.appendChild(img);
                        });
                    }
                });
            </script>
        }
    </div>
</div>

